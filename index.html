<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Islandia 2026 - Navegaci√≥n</title>

  <!-- SEO + Social (preview en WhatsApp/Facebook) -->
  <meta name="description" content="Itinerario Islandia Febrero 2026: rutas GPS, paradas por d√≠a y puntos de auroras." />
  <meta property="og:title" content="Islandia 2026 - Rutas GPS" />
  <meta property="og:description" content="Itinerario completo por d√≠as con enlaces a Google Maps y coordenadas para auroras." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://adoff9214.github.io/intinerario-islandia-2026/" />

  <!-- PWA -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="Islandia 2026" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="theme-color" content="#0f172a" />
  <link rel="manifest" href="manifest.json" />

  <!-- Icono App (Apple touch icon embebido) -->
  <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj48cmVjdCB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgcng9IjExMCIgZmlsbD0iIzBmMTcyYSIvPjxjaXJjbGUgY3g9IjI1NiIgY3k9IjI1NiIgcj0iMTYwIiBmaWxsPSJub25lIiBzdHJva2U9IiMzYjgyZjYiIHN0cm9rZS13aWR0aD0iMjAiLz48cGF0aCBkPSJNMjU2IDk2djMyTTI1NiAzODR2MzJNOTYgMjU2aDMyTTM4NCAyNTZoMzIiIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzNiODJmNiIgc3Ryb2tlLXdpZHRoPSIyMCIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+PHBhdGggZD0iTTI1NiAxNjBsNDAgOTZoLTgweiIgZmlsbD0iI2VmMzQ0NCIvPjxwYXRoIGQ9Ik0yNTYgMzUybC00MC05Nmg4MHoiIGZpbGw9IiNlMmVhZjAiLz48cGF0aCBkPSJNMTEwIDE0MGMxMDAgNTAgMjAwLTMwIDMwMCAyMCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMmRkNGJmIiBzdHJva2Utd2lkdGg9IjE1IiBzdHJva2UtbGluZWNhcD0icm91bmQiIG9wYWNpdHk9IjAuNiIvPjwvc3ZnPg==" />

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />

  <style>
    @import url("https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=JetBrains+Mono:wght@500&display=swap");
    body {
      font-family: "Inter", sans-serif;
      background-color: #f8fafc;
      color: #1e293b;
      -webkit-tap-highlight-color: transparent;
    }
    .mono { font-family: "JetBrains Mono", monospace; }
    .sticky-header {
      position: sticky;
      top: 0;
      z-index: 100;
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid #e2e8f0;
    }
    .day-tab { transition: all 0.3s ease; }
    .day-tab.active { background-color: #1e293b; color: white; transform: scale(1.05); }
    .glass-card { background: white; border: 1px solid #e2e8f0; border-radius: 20px; }
    .aurora-gradient { background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); }
    .btn-full-route { background: linear-gradient(90deg, #2563eb 0%, #3b82f6 100%); }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .animate-fade { animation: fadeIn 0.4s ease-out forwards; }
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
</head>

<body class="min-h-screen pb-10">
  <header class="sticky-header shadow-sm">
    <div class="container mx-auto px-4 py-4">
      <div class="flex items-center justify-between mb-4">
        <div class="flex items-center gap-2">
          <div class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center text-white">
            <i class="fas fa-route text-xs"></i>
          </div>
          <h1 class="text-lg font-extrabold tracking-tight">
            Islandia <span class="text-blue-600">2026</span>
          </h1>
        </div>
        <div class="text-[10px] font-bold text-slate-500 uppercase tracking-widest bg-slate-100 px-3 py-1 rounded-full border border-slate-200">
          Rutas GPS
        </div>
      </div>
      <div class="flex overflow-x-auto gap-2 no-scrollbar pb-1" id="day-selector"></div>
    </div>
  </header>

  <main class="container mx-auto px-4 py-6 max-w-2xl">
    <!-- Bot√≥n Instalar PWA -->
    <div id="install-container" class="mb-6 hidden">
      <button id="installBtn"
        class="w-full aurora-gradient text-white py-4 rounded-2xl font-extrabold shadow-xl flex items-center justify-center gap-3">
        <i class="fas fa-download"></i> INSTALAR APP
      </button>
    </div>

    <!-- Instrucciones iPhone -->
    <div id="ios-install" class="mb-6 hidden glass-card p-4 text-center">
      <p class="text-sm font-bold text-slate-700">
        üì± En iPhone: toca <strong>Compartir</strong> ‚Üí <strong>Agregar a pantalla de inicio</strong>
      </p>
    </div>

    <!-- Offline por d√≠a -->
    <div class="mb-6 glass-card p-4">
      <div class="flex items-center justify-between gap-3">
        <div>
          <div class="text-xs font-black uppercase tracking-widest text-slate-400">Offline</div>
          <div id="offlineStatus" class="text-sm font-bold text-slate-800">D√≠a no guardado</div>
        </div>
        <div class="flex gap-2">
          <button id="saveDayOfflineBtn"
            class="px-4 py-3 rounded-2xl font-extrabold bg-slate-900 text-white">
            <i class="fas fa-cloud-download-alt mr-2"></i>Guardar d√≠a
          </button>
          <button id="removeDayOfflineBtn"
            class="px-4 py-3 rounded-2xl font-extrabold bg-slate-100 text-slate-700 border border-slate-200">
            <i class="fas fa-trash mr-2"></i>Borrar
          </button>
        </div>
      </div>
      <p class="text-[11px] text-slate-500 mt-3">
        Guarda este d√≠a para verlo sin internet (ideal en carretera).
      </p>
    </div>

    <!-- Bot√≥n de Ruta Completa -->
    <div id="full-route-container" class="mb-6"></div>

    <div id="day-content" class="animate-fade"></div>
  </main>

  <div id="toast"
    class="fixed bottom-10 left-1/2 -translate-x-1/2 bg-slate-900 text-white px-6 py-3 rounded-2xl shadow-2xl opacity-0 transition-all pointer-events-none z-[200] flex items-center gap-2">
    <i class="fas fa-check-circle text-teal-400"></i>
    <span class="text-sm font-bold uppercase tracking-wide">Copiado</span>
  </div>

  <script>
    const tripData = [
  { 
    day: 1,
    date: "Dom 01 Feb 2026",
    title: "Llegada y Reikiavik",
    accommodation: "Center Hotels Plaza",
    stops: [
      { time: "06:15 AM", name: "Aeropuerto KEF", coords: "63.985000,-22.605600", icon: "fa-plane-arrival" },
      { time: "07:00 AM", name: "Recogida/Devoluci√≥n Sixt (Blikav√∂llur 5)", coords: "63.998988,-22.630001", icon: "fa-car" },
      { time: "09:00 AM", name: "Centro Reikiavik", coords: "64.147993,-21.940791", icon: "fa-coffee" },
      { time: "11:00 AM", name: "Hallgr√≠mskirkja", coords: "64.142000,-21.926500", icon: "fa-church" },
      { time: "01:00 PM", name: "Caf√© Babal√∫", coords: "64.143200,-21.926800", icon: "fa-mug-hot" },
      { time: "03:00 PM", name: "Center Hotels Plaza (Entrada)", coords: "64.147993,-21.940791", icon: "fa-hotel" },
      { time: "05:00 PM", name: "Harpa Concert Hall", coords: "64.150400,-21.932500", icon: "fa-landmark" },
      { time: "07:30 PM", name: "Faro Gr√≥tta (Parking)", coords: "64.163933,-21.995247", icon: "fa-lightbulb" }
    ],
    aurora: { time: "09:00 PM", name: "Kleifarvatn", coords: "63.933500,-22.058300", rating: "8.5/10" }
  },

  { 
    day: 2,
    date: "Lun 02 Feb 2026",
    title: "C√≠rculo Dorado",
    accommodation: "Selfoss / Capital",
    stops: [
      { time: "09:30 AM", name: "√ûingvellir Parking P5 (Valh√∂ll)", coords: "64.255812,-21.129942", icon: "fa-mountain" },
      { time: "11:30 AM", name: "Geysir (Parking principal)", coords: "64.310418,-20.302418", icon: "fa-volcano" },
      { time: "01:00 PM", name: "Gullfoss", coords: "64.325100,-20.124600", icon: "fa-water" },
      { time: "02:30 PM", name: "Fri√∞heimar (Entrada)", coords: "64.177601,-20.444939", icon: "fa-utensils" },
      { time: "04:30 PM", name: "Secret Lagoon (Gamla Laugin)", coords: "64.137300,-20.309200", icon: "fa-hot-tub" },
      { time: "06:30 PM", name: "Cr√°ter Keri√∞ (Parking)", coords: "63.941300,-20.885100", icon: "fa-circle-notch" }
    ],
    aurora: { time: "10:00 PM", name: "√ûingvellir P5 (Valh√∂ll)", coords: "64.255812,-21.129942", rating: "9.4/10" }
  },

  { 
    day: 3,
    date: "Mar 03 Feb 2026",
    title: "Costa Sur",
    accommodation: "Hvammb√≥l Guesthouse",
    stops: [
      { time: "09:30 AM", name: "Seljalandsfoss (Parking)", coords: "63.615884,-19.989737", icon: "fa-water" },
      { time: "11:00 AM", name: "Sk√≥gafoss (Parking)", coords: "63.527987,-19.511918", icon: "fa-water" },
      { time: "02:00 PM", name: "S√≥lheimaj√∂kull (Parking tours)", coords: "63.532833,-19.369675", icon: "fa-snowflake" },
      { time: "04:30 PM", name: "Reynisfjara (Parking P1 abajo)", coords: "63.404300,-19.044800", icon: "fa-umbrella-beach" },
      { time: "06:00 PM", name: "Hvammb√≥l Guesthouse (Entrada)", coords: "63.434725,-19.012534", icon: "fa-bed" }
    ],
    aurora: { time: "09:30 PM", name: "Dyrh√≥laey Upper", coords: "63.402900,-19.121400", rating: "9.0/10" }
  },

  { 
    day: 4,
    date: "Mi√© 04 Feb 2026",
    title: "Glaciares del Este",
    accommodation: "Arnanes Country Hotel",
    stops: [
      { time: "10:00 AM", name: "J√∂kuls√°rl√≥n (Parking principal)", coords: "64.048308,-16.179308", icon: "fa-cube" },
      { time: "11:30 AM", name: "Diamond Beach (Parking)", coords: "64.044349,-16.177725", icon: "fa-gem" },
      { time: "01:30 PM", name: "H√∂fn", coords: "64.253900,-15.208200", icon: "fa-fish" },
      { time: "04:00 PM", name: "Stokksnes / Vestrahorn (Barrera/Viking Caf√©)", coords: "64.240900,-14.963500", icon: "fa-camera" },
      { time: "06:00 PM", name: "Arnanes Country Hotel", coords: "64.298500,-15.275400", icon: "fa-hotel" }
    ],
    aurora: { time: "10:00 PM", name: "Stokksnes / Vestrahorn", coords: "64.240900,-14.963500", rating: "10/10" }
  },

  { 
    day: 5,
    date: "Jue 05 Feb 2026",
    title: "Retorno a Capital",
    accommodation: "R13 Townhouse",
    stops: [
      { time: "10:00 AM", name: "Fja√∞r√°rglj√∫fur (Parking)", coords: "63.771200,-18.171700", icon: "fa-mountain" },
      { time: "01:00 PM", name: "Lava Centre", coords: "63.753300,-20.219700", icon: "fa-fire" },
      { time: "04:30 PM", name: "R13 Reikiavik", coords: "64.138800,-21.888400", icon: "fa-home" },
      { time: "06:30 PM", name: "Sky Lagoon (Entrada)", coords: "64.113600,-21.910000", icon: "fa-hot-tub" }
    ],
    aurora: { time: "10:00 PM", name: "√ñrengsl√≠ Pass", coords: "63.934700,-21.999200", rating: "8.7/10" }
  },

  { 
    day: 6,
    date: "Vie 06 Feb 2026",
    title: "Oeste y Glaciar",
    accommodation: "Fossat√∫n Guesthouse",
    stops: [
      { time: "11:00 AM", name: "H√∫safell Center (Meeting Point invierno)", coords: "64.699167,-20.868633", icon: "fa-truck-monster" },
      { time: "02:30 PM", name: "Hraunfossar / Barnafoss (Parking)", coords: "64.702800,-20.977200", icon: "fa-water" },
      { time: "04:30 PM", name: "Fossat√∫n Guesthouse", coords: "64.591900,-21.511400", icon: "fa-bed" }
    ],
    aurora: { time: "09:30 PM", name: "Kirkjufellsfoss", coords: "64.939400,-23.307500", rating: "10/10" }
  },

  { 
    day: 7,
    date: "S√°b 07 Feb 2026",
    title: "Loop Sn√¶fellsnes",
    accommodation: "Fossat√∫n Guesthouse",
    stops: [
      { time: "09:30 AM", name: "Ytri-Tunga (Parking focas)", coords: "64.803300,-23.081100", icon: "fa-paw" },
      { time: "11:00 AM", name: "B√∫√∞akirkja (Parking)", coords: "64.821700,-23.384500", icon: "fa-church" },
      { time: "12:30 PM", name: "Arnarstapi", coords: "64.769100,-23.621600", icon: "fa-shoe-prints" },
      { time: "02:30 PM", name: "Dj√∫pal√≥nssandur", coords: "64.753600,-23.593000", icon: "fa-umbrella-beach" },
      { time: "04:30 PM", name: "Cr√°ter Saxh√≥ll", coords: "64.851100,-23.924500", icon: "fa-mountain" },
      { time: "06:30 PM", name: "Kirkjufell / Kirkjufellsfoss (Parking)", coords: "64.939400,-23.307500", icon: "fa-camera" }
    ],
    aurora: { time: "10:00 PM", name: "Kirkjufellsfoss", coords: "64.939400,-23.307500", rating: "10/10" }
  },

  { 
    day: 8,
    date: "Dom 08 Feb 2026",
    title: "Blue Lagoon y Fin",
    accommodation: "N/A",
    stops: [
      { time: "10:00 AM", name: "Blue Lagoon (Parking oficial)", coords: "63.880400,-22.449500", icon: "fa-hot-tub" },
      { time: "01:30 PM", name: "Almuerzo Grindav√≠k", coords: "63.843100,-22.433400", icon: "fa-utensils" },
      { time: "02:30 PM", name: "Devoluci√≥n Sixt KEF (Blikav√∂llur 5)", coords: "63.998988,-22.630001", icon: "fa-undo" },
      { time: "05:15 PM", name: "Vuelo Regreso KEF", coords: "63.985000,-22.605600", icon: "fa-plane-departure" }
    ],
    aurora: null
  }
];

    let activeIndex = 0;

    function showToast() {
      const t = document.getElementById("toast");
      if (!t) return;
      t.style.opacity = "1";
      t.style.transform = "translate(-50%, -10px)";
      setTimeout(() => {
        t.style.opacity = "0";
        t.style.transform = "translate(-50%, 0px)";
      }, 2000);
    }

    // Copy robusto (iPhone friendly)
    async function copy(text) {
      try {
        await navigator.clipboard.writeText(text);
        showToast();
      } catch (e) {
        const ta = document.createElement("textarea");
        ta.value = text;
        ta.style.position = "fixed";
        ta.style.top = "-1000px";
        document.body.appendChild(ta);
        ta.focus();
        ta.select();
        try {
          document.execCommand("copy");
          showToast();
        } finally {
          document.body.removeChild(ta);
        }
      }
    }

    function getMaps(coords) {
      return `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(coords)}`;
    }

    // Ruta completa (con encode)
    function getFullRoute(stops) {
  const baseUrl = "https://www.google.com/maps/dir/?api=1";

  const origin = encodeURIComponent(stops[0].coords);
  const destination = encodeURIComponent(stops[stops.length - 1].coords);

  const waypointsArray = stops.slice(1, -1).map(s => s.coords);
  const waypoints = encodeURIComponent(waypointsArray.join("|"));

  return `${baseUrl}&origin=${origin}&destination=${destination}&waypoints=${waypoints}&travelmode=driving`;
}

    function renderTabs() {
      const container = document.getElementById("day-selector");
      container.innerHTML = tripData.map((d, i) => `
        <button onclick="setDay(${i})"
          class="day-tab flex-shrink-0 px-5 py-2 rounded-2xl text-sm font-bold border border-slate-200 ${activeIndex === i ? "active" : "bg-white text-slate-500"}">
          <span class="block text-[10px] opacity-60 uppercase tracking-tighter">D√≠a</span>
          ${d.day}
        </button>
      `).join("");
    }

    function setDay(i) {
      activeIndex = i;
      renderTabs();
      renderContent();
      updateOfflineUI();
      window.scrollTo({ top: 0, behavior: "smooth" });
    }

    function renderContent() {
      const day = tripData[activeIndex];
      const container = document.getElementById("day-content");
      const routeBtnContainer = document.getElementById("full-route-container");

      routeBtnContainer.innerHTML = `
        <a href="${getFullRoute(day.stops)}" target="_blank"
          class="btn-full-route block w-full text-center py-4 rounded-2xl text-white font-extrabold shadow-lg flex items-center justify-center gap-3">
          <i class="fas fa-map-marked-alt"></i> NAVEGAR RUTA COMPLETA D√çA ${day.day}
        </a>
      `;

      let aurora = "";
      if (day.aurora) {
        aurora = `
          <div class="aurora-gradient text-white rounded-[28px] p-6 mb-6 shadow-2xl relative overflow-hidden border border-teal-500/20">
            <div class="absolute -right-10 -top-10 w-40 h-40 bg-teal-500/10 blur-[50px] rounded-full"></div>
            <div class="flex items-center justify-between mb-4">
              <div class="flex items-center gap-2">
                <span class="bg-teal-500 text-white text-[10px] font-black px-2 py-0.5 rounded">${day.aurora.time}</span>
                <span class="text-[10px] font-bold uppercase tracking-widest text-teal-400">Aurora Hunt</span>
              </div>
              <span class="text-xs font-bold text-teal-400">${day.aurora.rating}</span>
            </div>
            <h3 class="text-xl font-extrabold mb-1">${day.aurora.name}</h3>
            <p class="text-slate-400 text-xs font-mono mb-6">${day.aurora.coords}</p>
            <div class="flex gap-2">
              <button onclick="copy('${day.aurora.coords}')"
                class="flex-1 bg-white/10 hover:bg-white/20 py-3 rounded-2xl text-sm font-bold">
                <i class="fas fa-copy mr-2"></i> GPS
              </button>
              <a href="${getMaps(day.aurora.coords)}" target="_blank"
                class="flex-1 bg-teal-600 hover:bg-teal-500 py-3 rounded-2xl text-sm font-bold flex items-center justify-center no-underline text-white">
                <i class="fab fa-google mr-2"></i> Maps
              </a>
            </div>
          </div>
        `;
      }

      const stops = day.stops.map(s => `
        <div class="glass-card p-4 flex items-center justify-between mb-3 hover:border-blue-300">
          <div class="flex items-center gap-4">
            <div class="flex flex-col items-center min-w-[50px]">
              <span class="text-[9px] font-black text-blue-600 uppercase leading-none">${s.time.split(" ")[1]}</span>
              <span class="text-xs font-black text-slate-800 leading-none mt-1">${s.time.split(" ")[0]}</span>
            </div>
            <div class="w-10 h-10 bg-slate-50 text-slate-400 rounded-xl flex items-center justify-center text-lg">
              <i class="fas ${s.icon}"></i>
            </div>
            <div>
              <h4 class="font-bold text-slate-800 leading-tight text-sm">${s.name}</h4>
              <p class="text-[9px] font-mono text-slate-400 mt-0.5">${s.coords}</p>
            </div>
          </div>
          <div class="flex gap-2">
            <button onclick="copy('${s.coords}')"
              class="w-10 h-10 bg-slate-50 text-slate-400 rounded-xl flex items-center justify-center">
              <i class="fas fa-copy"></i>
            </button>
            <a href="${getMaps(s.coords)}" target="_blank"
              class="w-10 h-10 bg-blue-50 text-blue-600 rounded-xl flex items-center justify-center">
              <i class="fab fa-google"></i>
            </a>
          </div>
        </div>
      `).join("");

      container.innerHTML = `
        <div class="mb-6 px-1">
          <div class="flex items-center gap-2 text-blue-600 font-bold text-xs uppercase tracking-widest mb-1">
            <i class="fas fa-calendar"></i> ${day.date}
          </div>
          <h2 class="text-3xl font-black text-slate-900 leading-tight">${day.title}</h2>
          <div class="mt-4 flex items-center gap-2 text-sm text-slate-500 font-medium">
            <i class="fas fa-bed text-blue-400"></i> ${day.accommodation}
          </div>
        </div>
        ${aurora}
        <div class="mt-8">
          <h3 class="text-[10px] font-bold text-slate-400 uppercase tracking-widest ml-1 mb-4">Paradas Detalladas</h3>
          ${stops}
        </div>
      `;
    }

    // ===== Offline por d√≠a (1 sola p√°gina) =====
    function getSavedDays() {
      try { return JSON.parse(localStorage.getItem("offlineDays") || "[]"); }
      catch { return []; }
    }
    function setSavedDays(arr) {
      localStorage.setItem("offlineDays", JSON.stringify(arr));
    }
    function dayKey(dayObj) {
      return `day-${dayObj.day}`;
    }

    function updateOfflineUI() {
      const day = tripData[activeIndex];
      const saved = getSavedDays();
      const savedNow = saved.includes(dayKey(day));

      const status = document.getElementById("offlineStatus");
      const saveBtn = document.getElementById("saveDayOfflineBtn");
      const rmBtn = document.getElementById("removeDayOfflineBtn");

      if (status) status.textContent = savedNow ? "‚úÖ D√≠a guardado offline" : "D√≠a no guardado";

      if (saveBtn) {
        saveBtn.disabled = savedNow;
        saveBtn.classList.toggle("opacity-60", savedNow);
      }
      if (rmBtn) {
        rmBtn.disabled = !savedNow;
        rmBtn.classList.toggle("opacity-60", !savedNow);
      }
    }

    async function saveCurrentDayOffline() {
      const day = tripData[activeIndex];
      const saved = getSavedDays();
      const key = dayKey(day);

      if (!saved.includes(key)) {
        saved.push(key);
        setSavedDays(saved);
      }

      const urlsToCache = ["./index.html", "./manifest.json", "./icon-192.png", "./icon-512.png"];

      // manda instrucci√≥n al Service Worker para cachear core + CDNs
      if (navigator.serviceWorker?.controller) {
        navigator.serviceWorker.controller.postMessage({
          type: "CACHE_DAY",
          day: key,
          urls: urlsToCache
        });
      }

      updateOfflineUI();
      showToast();
    }

    function removeCurrentDayOffline() {
      const day = tripData[activeIndex];
      const key = dayKey(day);
      const saved = getSavedDays().filter(k => k !== key);
      setSavedDays(saved);
      updateOfflineUI();
    }

    // ===== PWA Install Button =====
    let deferredPrompt;

    function isIOS() {
      return /iphone|ipad|ipod/i.test(navigator.userAgent);
    }
    function isInStandalone() {
      return window.matchMedia("(display-mode: standalone)").matches || window.navigator.standalone === true;
    }

    window.addEventListener("beforeinstallprompt", (e) => {
      e.preventDefault();
      deferredPrompt = e;
      if (!isInStandalone()) {
        document.getElementById("install-container")?.classList.remove("hidden");
      }
    });

    async function handleInstallClick() {
      if (!deferredPrompt) return;
      deferredPrompt.prompt();
      await deferredPrompt.userChoice;
      deferredPrompt = null;
      document.getElementById("install-container")?.classList.add("hidden");
    }

    // ===== Service Worker Register =====
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker.register("service-worker.js");
      });
    }

    // ===== Init =====
    window.onload = () => {
      renderTabs();
      renderContent();

      // offline buttons
      document.getElementById("saveDayOfflineBtn")?.addEventListener("click", saveCurrentDayOffline);
      document.getElementById("removeDayOfflineBtn")?.addEventListener("click", removeCurrentDayOffline);

      // install button
      document.getElementById("installBtn")?.addEventListener("click", handleInstallClick);

      // iOS install helper
      if (isIOS() && !isInStandalone()) {
        document.getElementById("ios-install")?.classList.remove("hidden");
      }

      // SW messages
      navigator.serviceWorker?.addEventListener("message", (event) => {
        if (event.data?.type === "CACHE_DAY_DONE") updateOfflineUI();
      });

      updateOfflineUI();
    };
  </script>
</body>
</html>


